<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GlassDrive MVP - Sistema Completo con Gesti√≥n de Archivos</title>
    <link rel="stylesheet" href="style.css">

    <!-- jsPDF para PDF con fotos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- LOGIN CORPORATIVO -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <img src="logolargo.png" alt="GlassDrive" class="login-logo" onerror="this.src='logolargo.jpg'">
                <h1>GlassDrive MVP</h1>
                <p>Sistema Completo con Gesti√≥n de Archivos</p>
                <div class="mvp-badge">
                    <span class="mvp-text">üöÄ MVP DEMO</span>
                    <span class="mvp-features">OCR ‚Ä¢ Archivos ‚Ä¢ PDF con Fotos</span>
                </div>
            </div>

            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="selectTaller">Centro GlassDrive:</label>
                    <select id="selectTaller" required>
                        <option value="">-- Seleccionar Centro --</option>
                        <option value="monzon">Monz√≥n</option>
                        <option value="barbastro">Barbastro</option>
                        <option value="lleida">Lleida</option>
                        <option value="fraga">Fraga</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary btn-large">
                    üöÄ Iniciar Demo MVP
                </button>
            </form>

            <div class="login-footer">
                <div class="demo-features">
                    <h4>‚ú® Funcionalidades MVP Demostradas:</h4>
                    <div class="features-grid">
                        <div class="feature-item">üì∏ Galer√≠a Interactiva</div>
                        <div class="feature-item">üîç OCR Real Simulado</div>
                        <div class="feature-item">üìÑ Gesti√≥n de Documentos</div>
                        <div class="feature-item">‚úçÔ∏è Firma Digital</div>
                        <div class="feature-item">üìã PDF con Fotos</div>
                        <div class="feature-item">üóÉÔ∏è Sistema de Archivos</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- APLICACI√ìN PRINCIPAL -->
    <div id="mainApp" class="screen">
        <!-- HEADER CON INDICADOR MVP -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <img src="logolargo.png" alt="GlassDrive" class="header-logo" onerror="this.src='logolargo.jpg'">
                    <div class="header-info">
                        <h2>GlassDrive MVP</h2>
                        <span id="userInfo" class="user-info"></span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="mvp-indicator">
                        <span class="mvp-dot"></span>
                        <span>DEMO ACTIVA</span>
                    </div>
                    <button id="btnLogout" class="btn btn-outline btn-sm">Cerrar</button>
                </div>
            </div>
        </header>

        <!-- NAVEGACI√ìN -->
        <nav class="app-nav">
            <button id="btnDashboard" class="nav-btn active">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Dashboard</span>
            </button>
            <button id="btnNuevoRegistro" class="nav-btn">
                <span class="nav-icon">üìù</span>
                <span class="nav-label">Nuevo OCR</span>
                <span class="nav-badge">MVP</span>
            </button>
            <button id="btnGaleria" class="nav-btn">
                <span class="nav-icon">üñºÔ∏è</span>
                <span class="nav-label">Galer√≠a</span>
                <span class="nav-badge">NEW</span>
            </button>
            <button id="btnBusqueda" class="nav-btn">
                <span class="nav-icon">üîç</span>
                <span class="nav-label">B√∫squeda</span>
            </button>
        </nav>

        <!-- DASHBOARD MEJORADO -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h3>Dashboard MVP - Sistema Completo</h3>
                <p>Gesti√≥n avanzada de archivos con OCR real y galer√≠a interactiva</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">üöó</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalVehiculos">0</div>
                        <div class="stat-label">Total Veh√≠culos</div>
                        <div class="stat-extra">Con archivos</div>
                    </div>
                </div>
                <div class="stat-card success">
                    <div class="stat-icon">üì∏</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalFotos">0</div>
                        <div class="stat-label">Fotos Guardadas</div>
                        <div class="stat-extra">En galer√≠a</div>
                    </div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-icon">üìÑ</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalDocumentos">0</div>
                        <div class="stat-label">Documentos OCR</div>
                        <div class="stat-extra">Procesados</div>
                    </div>
                </div>
                <div class="stat-card info">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalPDFs">0</div>
                        <div class="stat-label">PDFs con Fotos</div>
                        <div class="stat-extra">Generados</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="recent-section">
                    <div class="section-header">
                        <h4>üìã Expedientes Recientes</h4>
                        <span class="badge badge-success">Con Archivos</span>
                    </div>
                    <div id="recentList" class="recent-list"></div>
                </div>

                <div class="features-demo-section">
                    <div class="section-header">
                        <h4>üéØ Funcionalidades MVP</h4>
                        <span class="badge badge-primary">DEMO</span>
                    </div>
                    <div class="features-demo">
                        <div class="demo-feature">
                            <div class="demo-icon">üîç</div>
                            <div class="demo-content">
                                <h5>OCR Inteligente</h5>
                                <p>Detecci√≥n autom√°tica de matr√≠culas y extracci√≥n de datos</p>
                                <div class="demo-status success">‚úì Implementado</div>
                            </div>
                        </div>
                        <div class="demo-feature">
                            <div class="demo-icon">üì∏</div>
                            <div class="demo-content">
                                <h5>Galer√≠a Avanzada</h5>
                                <p>Gesti√≥n completa con vista ampliada y organizaci√≥n</p>
                                <div class="demo-status success">‚úì Implementado</div>
                            </div>
                        </div>
                        <div class="demo-feature">
                            <div class="demo-icon">üóÉÔ∏è</div>
                            <div class="demo-content">
                                <h5>Gesti√≥n de Archivos</h5>
                                <p>Almacenamiento permanente y organizaci√≥n autom√°tica</p>
                                <div class="demo-status success">‚úì Implementado</div>
                            </div>
                        </div>
                        <div class="demo-feature">
                            <div class="demo-icon">üìã</div>
                            <div class="demo-content">
                                <h5>PDF con Fotos</h5>
                                <p>Generaci√≥n autom√°tica incluyendo todas las im√°genes</p>
                                <div class="demo-status success">‚úì Implementado</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- NUEVA SECCI√ìN: GALER√çA GLOBAL -->
        <section id="galeria" class="content-section">
            <div class="section-header">
                <h3>üñºÔ∏è Galer√≠a Global de Archivos</h3>
                <p>Visualizaci√≥n y gesti√≥n completa de todos los archivos del sistema</p>
            </div>

            <div class="galeria-filters">
                <div class="filter-group">
                    <label>Filtrar por:</label>
                    <select id="filterType">
                        <option value="all">Todos los archivos</option>
                        <option value="fotos">Solo fotos</option>
                        <option value="documentos">Solo documentos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Matr√≠cula:</label>
                    <input type="text" id="filterMatricula" placeholder="Buscar matr√≠cula...">
                </div>
                <button id="btnFilterGaleria" class="btn btn-primary">üîç Filtrar</button>
            </div>

            <div id="galeriaGlobal" class="galeria-global"></div>
        </section>

        <!-- B√öSQUEDA MEJORADA -->
        <section id="busqueda" class="content-section">
            <div class="section-header">
                <h3>üîç B√∫squeda Avanzada de Expedientes</h3>
                <p>Buscar expedientes con visualizaci√≥n de archivos asociados</p>
            </div>

            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Buscar por matr√≠cula, cliente, veh√≠culo...">
                    <button id="btnSearch" class="btn btn-primary">
                        <span class="btn-icon">üîç</span>
                        Buscar
                    </button>
                </div>
                <div class="search-stats">
                    <span id="searchStats"></span>
                </div>
            </div>

            <div id="searchResults" class="search-results"></div>
        </section>
    </div>

    <!-- MODAL DE REGISTRO COMPLETO -->
    <div id="registroModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <h3>üöÄ Nuevo Registro MVP - Sistema Completo</h3>
                    <p>Demostraci√≥n de todas las funcionalidades avanzadas</p>
                </div>
                <button id="closeModal" class="modal-close">&times;</button>
            </div>

            <!-- PROGRESS STEPS MEJORADOS -->
            <div class="steps-container">
                <div class="step active">
                    <div class="step-icon">üì∏</div>
                    <div class="step-content">
                        <span class="step-number">1</span>
                        <span class="step-label">Galer√≠a OCR</span>
                        <span class="step-badge">NEW</span>
                    </div>
                </div>
                <div class="step">
                    <div class="step-icon">üìÑ</div>
                    <div class="step-content">
                        <span class="step-number">2</span>
                        <span class="step-label">Documentos</span>
                        <span class="step-badge">MVP</span>
                    </div>
                </div>
                <div class="step">
                    <div class="step-icon">‚úçÔ∏è</div>
                    <div class="step-content">
                        <span class="step-number">3</span>
                        <span class="step-label">Firma</span>
                    </div>
                </div>
                <div class="step">
                    <div class="step-icon">üìã</div>
                    <div class="step-content">
                        <span class="step-number">4</span>
                        <span class="step-label">PDF Final</span>
                        <span class="step-badge">NEW</span>
                    </div>
                </div>
            </div>

            <!-- PASO 1: GALER√çA AVANZADA CON OCR -->
            <div id="step1" class="step-content active">
                <div class="step-header">
                    <h4>üì∏ Galer√≠a Avanzada con OCR Autom√°tico</h4>
                    <p>Sistema completo de gesti√≥n de fotos con detecci√≥n autom√°tica de matr√≠cula</p>
                </div>

                <div class="mvp-info-panel">
                    <div class="panel-icon">üß†</div>
                    <div class="panel-content">
                        <h5>Tecnolog√≠a OCR MVP Implementada:</h5>
                        <ul>
                            <li>‚úÖ <strong>Detecci√≥n autom√°tica:</strong> Matr√≠cula 6792LNJ en tiempo real</li>
                            <li>‚úÖ <strong>Galer√≠a interactiva:</strong> Vista ampliada, eliminaci√≥n, metadatos</li>
                            <li>‚úÖ <strong>Almacenamiento:</strong> Archivos organizados por matr√≠cula</li>
                            <li>‚úÖ <strong>Backend simulado:</strong> APIs REST completas</li>
                        </ul>
                    </div>
                </div>

                <div class="camera-advanced-container">
                    <video id="cameraPreview" autoplay playsinline></video>
                    <canvas id="photoCanvas" style="display: none;"></canvas>

                    <div class="camera-controls-advanced">
                        <button id="startCamera" class="btn btn-info">
                            <span class="btn-icon">üì∑</span>
                            Abrir C√°mara
                        </button>
                        <button id="capturePhoto" class="btn btn-success" style="display: none;">
                            <span class="btn-icon">üì∏</span>
                            Capturar Foto
                        </button>
                        <button id="uploadPhoto" class="btn btn-secondary">
                            <span class="btn-icon">üìÅ</span>
                            Subir Archivos
                        </button>
                        <input type="file" id="photoInput" accept="image/*" multiple style="display: none;">
                    </div>
                </div>

                <!-- GALER√çA INTERACTIVA -->
                <div id="photosGrid" class="photos-grid-advanced"></div>

                <!-- RESULTADO OCR MEJORADO -->
                <div id="ocrResult" class="ocr-result-advanced"></div>

                <!-- PANEL DE ARCHIVOS -->
                <div id="filesPanel" class="files-panel">
                    <h5>üìÅ Gesti√≥n de Archivos MVP</h5>
                    <div id="filesList" class="files-list"></div>
                </div>
            </div>

            <!-- PASO 2: DOCUMENTOS AVANZADOS -->
            <div id="step2" class="step-content">
                <div class="step-header">
                    <h4>üìÑ Gesti√≥n Avanzada de Documentos</h4>
                    <p>OCR especializado con almacenamiento permanente y vista previa</p>
                </div>

                <div class="documents-advanced-container">
                    <div class="document-section-advanced ficha">
                        <div class="document-header-advanced">
                            <div class="document-icon">üìã</div>
                            <div class="document-info">
                                <h5>Ficha T√©cnica del Veh√≠culo</h5>
                                <p>OCR extrae: Marca, modelo, a√±o, potencia, combustible, VIN</p>
                                <div class="tech-badges">
                                    <span class="tech-badge">Tesseract.js</span>
                                    <span class="tech-badge">Google Vision</span>
                                    <span class="tech-badge">Sharp</span>
                                </div>
                            </div>
                        </div>
                        <div class="upload-zone" id="fichaUploadZone">
                            <div class="upload-icon">üìã</div>
                            <p>Arrastra ficha t√©cnica aqu√≠ o haz clic para seleccionar</p>
                            <button class="btn btn-info">Seleccionar Ficha</button>
                        </div>
                        <input type="file" id="fichaInput" accept="image/*,.pdf" style="display: none;">
                        <div id="fichaPreview" class="document-preview-advanced"></div>
                        <div id="fichaData" class="extracted-data-advanced"></div>
                    </div>

                    <div class="document-section-advanced poliza">
                        <div class="document-header-advanced">
                            <div class="document-icon">üõ°Ô∏è</div>
                            <div class="document-info">
                                <h5>P√≥liza de Seguro</h5>
                                <p>OCR extrae: Aseguradora, titular, DNI, vigencia, modalidad</p>
                                <div class="tech-badges">
                                    <span class="tech-badge">OCR Real</span>
                                    <span class="tech-badge">RegEx</span>
                                    <span class="tech-badge">AI</span>
                                </div>
                            </div>
                        </div>
                        <div class="upload-zone" id="polizaUploadZone">
                            <div class="upload-icon">üõ°Ô∏è</div>
                            <p>Arrastra p√≥liza aqu√≠ o haz clic para seleccionar</p>
                            <button class="btn btn-warning">Seleccionar P√≥liza</button>
                        </div>
                        <input type="file" id="polizaInput" accept="image/*,.pdf" style="display: none;">
                        <div id="polizaPreview" class="document-preview-advanced"></div>
                        <div id="polizaData" class="extracted-data-advanced"></div>
                    </div>
                </div>
            </div>

            <!-- PASO 3: FIRMA DIGITAL MEJORADA -->
            <div id="step3" class="step-content">
                <div class="step-header">
                    <h4>‚úçÔ∏è Firma Digital Avanzada</h4>
                    <p>Sistema de captura de firma con validaci√≥n y almacenamiento seguro</p>
                </div>

                <div class="signature-advanced-section">
                    <div class="signature-container-advanced">
                        <canvas id="signatureCanvas" class="signature-canvas-advanced"></canvas>
                        <div class="signature-placeholder">
                            <div class="placeholder-icon">‚úçÔ∏è</div>
                            <p>Firme aqu√≠ con rat√≥n, dedo o stylus</p>
                            <small>Firma compatible con dispositivos t√°ctiles</small>
                        </div>
                    </div>

                    <div class="signature-controls-advanced">
                        <button id="clearSignature" class="btn btn-outline">
                            <span class="btn-icon">üóëÔ∏è</span>
                            Limpiar
                        </button>
                        <button id="saveSignature" class="btn btn-success">
                            <span class="btn-icon">‚úÖ</span>
                            Guardar Firma
                        </button>
                        <button id="validateSignature" class="btn btn-info" style="display: none;">
                            <span class="btn-icon">üîç</span>
                            Validar
                        </button>
                    </div>

                    <div class="signature-info-advanced">
                        <div class="info-panel">
                            <h6>üîí Seguridad de Firma Digital</h6>
                            <ul>
                                <li>Captura con resoluci√≥n HD</li>
                                <li>Timestamp autom√°tico</li>
                                <li>Validaci√≥n de trazos</li>
                                <li>Almacenamiento cifrado</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PASO 4: RESUMEN COMPLETO CON VISTA PREVIA PDF -->
            <div id="step4" class="step-content">
                <div class="step-header">
                    <h4>üìã Resumen Final - Expediente Completo</h4>
                    <p>Vista previa del PDF con todas las fotos y datos extra√≠dos</p>
                </div>

                <div id="summary" class="summary-advanced-container"></div>

                <div class="pdf-preview-section">
                    <div class="section-header">
                        <h5>üìÑ Vista Previa del PDF</h5>
                        <p>El PDF incluir√° autom√°ticamente todas las fotos y datos</p>
                    </div>

                    <div class="pdf-preview">
                        <div class="pdf-page-preview">
                            <div class="pdf-content">
                                <div class="pdf-header">
                                    <img src="logolargo.png" alt="GlassDrive" class="pdf-logo" onerror="this.src='logolargo.jpg'">
                                    <h3>INFORME DE RECEPCI√ìN</h3>
                                </div>
                                <div class="pdf-data">
                                    <p><strong>Matr√≠cula:</strong> <span id="pdfMatricula">-</span></p>
                                    <p><strong>Cliente:</strong> <span id="pdfCliente">-</span></p>
                                    <p><strong>Veh√≠culo:</strong> <span id="pdfVehiculo">-</span></p>
                                </div>
                                <div class="pdf-photos">
                                    <p><strong>üì∏ Fotograf√≠as:</strong> <span id="pdfFotoCount">0</span> fotos incluidas</p>
                                    <div id="pdfPhotosPreview" class="pdf-photos-preview"></div>
                                </div>
                                <div class="pdf-signature">
                                    <p><strong>‚úçÔ∏è Firma:</strong> <span id="pdfFirmaStatus">-</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="generation-options">
                    <h6>üéõÔ∏è Opciones de Generaci√≥n</h6>
                    <div class="options-grid">
                        <label class="option-item">
                            <input type="checkbox" id="includeFotos" checked>
                            <span>Incluir todas las fotos</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" id="includeOCR" checked>
                            <span>Incluir datos OCR</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" id="includeFirma" checked>
                            <span>Incluir firma digital</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" id="includeMetadata" checked>
                            <span>Incluir metadatos</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- MODAL FOOTER MEJORADO -->
            <div class="modal-footer-advanced">
                <div class="footer-info">
                    <div class="processing-status">
                        <span class="status-dot active"></span>
                        <span>MVP Demo Activo</span>
                    </div>
                    <div class="tech-info">
                        <span class="tech-item">üîç OCR</span>
                        <span class="tech-item">üì∏ Galer√≠a</span>
                        <span class="tech-item">üóÉÔ∏è Archivos</span>
                    </div>
                </div>
                <div class="footer-controls">
                    <button id="prevStep" class="btn btn-outline">
                        <span class="btn-icon">‚Üê</span>
                        Anterior
                    </button>
                    <button id="nextStep" class="btn btn-primary">
                        Siguiente
                        <span class="btn-icon">‚Üí</span>
                    </button>
                    <button id="finishStep" class="btn btn-success" style="display: none;">
                        <span class="btn-icon">üöÄ</span>
                        Finalizar MVP
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>