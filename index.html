<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlassDrive RCG</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- PANTALLA DE LOGIN -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <div class="logo-container">
                    <img src="logolargo.png" alt="GlassDrive" class="login-logo">
                </div>
                <h1>GlassDrive MVP</h1>
                <p>GestiÃ³n de Entrada y calibraciones</p>
            </div>

            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="selectTaller">Centro GlassDrive:</label>
                    <select id="selectTaller" required>
                        <option value="">-- Seleccionar Centro --</option>
                        <option value="monzon">MonzÃ³n</option>
                        <option value="barbastro">Barbastro</option>
                        <option value="lleida">Lleida</option>
                        <option value="fraga">Fraga</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary btn-large">
                    ğŸš€ Iniciar Demo 
                </button>
            </form>
        </div>
    </div>

    <!-- APLICACIÃ“N PRINCIPAL -->
    <div id="mainApp" class="screen">
        <!-- HEADER -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-container-header">
                        <img src="logolargo.png" alt="GlassDrive" class="header-logo">
                    </div>
                    <div class="header-info">
                        <h2>GlassDrive MVP</h2>
                        <span id="userInfo" class="user-info"></span>
                    </div>
                </div>
                <div class="header-right">
                    <button id="btnLogout" class="btn btn-outline btn-sm">Cerrar</button>
                </div>
            </div>
        </header>

        <!-- NAVEGACIÃ“N COMPLETA -->
        <nav class="app-nav">
            <button id="btnDashboard" class="nav-btn active">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-label">Dashboard</span>
            </button>
            <button id="btnNuevoRegistro" class="nav-btn">
                <span class="nav-icon">ğŸ“</span>
                <span class="nav-label">Nuevo</span>
            </button>
            <button id="btnCalibraciones" class="nav-btn">
                <span class="nav-icon">ğŸ¯</span>
                <span class="nav-label">Calibrar</span>
            </button>
            <button id="btnBusqueda" class="nav-btn">
                <span class="nav-icon">ğŸ”</span>
                <span class="nav-label">Buscar</span>
            </button>
        </nav>

        <!-- DASHBOARD -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h3>Dashboard MVP</h3>
                <p>Sistema con gestiÃ³n de calibraciones</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">ğŸš—</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalVehiculos">0</div>
                        <div class="stat-label">VehÃ­culos</div>
                    </div>
                </div>
                <div class="stat-card success">
                    <div class="stat-icon">ğŸ“¸</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalFotos">0</div>
                        <div class="stat-label">Fotos</div>
                    </div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-icon">ğŸ¯</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalCalibraciones">0</div>
                        <div class="stat-label">Calibraciones</div>
                    </div>
                </div>
                <div class="stat-card info">
                    <div class="stat-icon">ğŸ“‹</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalPDFs">0</div>
                        <div class="stat-label">PDFs</div>
                    </div>
                </div>
            </div>

            <div class="recent-section">
                <div class="section-header">
                    <h4>ğŸ“‹ Expedientes Recientes</h4>
                </div>
                <div id="recentList" class="recent-list"></div>
            </div>
        </section>

        <!-- CALIBRACIONES -->
        <section id="calibraciones" class="content-section">
            <div class="section-header">
                <h3>ğŸ¯ GestiÃ³n de Calibraciones</h3>
                <p>VehÃ­culos pendientes y completados</p>
            </div>

            <div class="calibraciones-tabs">
                <button id="tabPendientes" class="tab-btn active">
                    ğŸ”„ Pendientes (<span id="pendientesCount">0</span>)
                </button>
                <button id="tabCompletadas" class="tab-btn">
                    âœ… Completadas (<span id="completadasCount">0</span>)
                </button>
            </div>

            <div id="calibracionesList" class="calibraciones-content"></div>
        </section>

        <!-- BÃšSQUEDA COMPLETA -->
        <section id="busqueda" class="content-section">
            <div class="section-header">
                <h3>ğŸ” BÃºsqueda de Expedientes</h3>
                <p>Localice expedientes por matrÃ­cula, cliente o vehÃ­culo</p>
            </div>

            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Buscar por matrÃ­cula, cliente o vehÃ­culo..." />
                    <button id="btnSearch" class="btn btn-primary btn-mobile">ğŸ” Buscar</button>
                </div>
            </div>

            <div id="searchResults" class="search-results"></div>
        </section>
    </div>

    <!-- MODAL DE REGISTRO CON CALIBRACIÃ“N FUNCIONAL -->
    <div id="registroModal" class="modal">
        <div class="modal-content-fixed">
            <div class="modal-header">
                <div class="modal-title">
                    <h3>ğŸ“ Nuevo Expediente</h3>
                    <p>Proceso: Foto â†’ Docs â†’ CalibraciÃ³n â†’ Firma â†’ PDF</p>
                </div>
                <button id="closeModal" class="modal-close">&times;</button>
            </div>

            <!-- STEPS -->
            <div class="steps-container">
                <div class="step active" data-step="1">
                    <div class="step-icon">ğŸ“¸</div>
                    <div class="step-label">Foto</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-icon">ğŸ“„</div>
                    <div class="step-label">Docs</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-icon">ğŸ¯</div>
                    <div class="step-label">Calibrar</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-icon">âœï¸</div>
                    <div class="step-label">Firma</div>
                </div>
                <div class="step" data-step="5">
                    <div class="step-icon">ğŸ“‹</div>
                    <div class="step-label">PDF</div>
                </div>
            </div>

            <!-- CONTENIDO SCROLLABLE -->
            <div class="modal-body-scrollable">

                <!-- PASO 1: FOTOS -->
                <div id="step1" class="step-panel active">
                    <div class="step-header">
                        <h4>ğŸ“¸ Captura de Foto</h4>
                        <p>Captura o sube la foto del vehÃ­culo</p>
                    </div>

                    <div class="camera-section">
                        <div class="camera-controls">
                            <button id="startCamera" class="btn btn-info btn-mobile">ğŸ“· Abrir CÃ¡mara</button>
                            <button id="uploadPhoto" class="btn btn-secondary btn-mobile">ğŸ“ Subir Foto</button>
                            <input type="file" id="photoInput" accept="image/*" multiple style="display: none;">
                        </div>

                        <div class="camera-container">
                            <video id="cameraPreview" autoplay playsinline style="display: none;"></video>
                            <button id="capturePhoto" class="btn btn-success btn-mobile" style="display: none;">ğŸ“¸ Capturar Foto</button>
                            <canvas id="photoCanvas" style="display: none;"></canvas>
                        </div>
                    </div>

                    <div id="photosGrid" class="photos-grid-mobile"></div>
                    <div id="ocrResult" class="ocr-result"></div>
                </div>

                <!-- PASO 2: DOCUMENTOS -->
                <div id="step2" class="step-panel">
                    <div class="step-header">
                        <h4>ğŸ“„ Documentos</h4>
                        <p>Sube la ficha tÃ©cnica y pÃ³liza</p>
                    </div>

                    <div class="documents-mobile">
                        <div class="document-section-mobile">
                            <h5>ğŸ“‹ Ficha TÃ©cnica</h5>
                            <div class="upload-zone-mobile" id="fichaUploadZone">
                                <div class="upload-icon">ğŸ“‹</div>
                                <p>Seleccionar ficha tÃ©cnica</p>
                                <button type="button" class="btn btn-info btn-mobile">Seleccionar</button>
                            </div>
                            <input type="file" id="fichaInput" accept="image/*,.pdf" style="display: none;">
                            <div id="fichaPreview" class="document-preview-mobile"></div>
                        </div>

                        <div class="document-section-mobile">
                            <h5>ğŸ›¡ï¸ PÃ³liza de Seguro</h5>
                            <div class="upload-zone-mobile" id="polizaUploadZone">
                                <div class="upload-icon">ğŸ›¡ï¸</div>
                                <p>Seleccionar pÃ³liza</p>
                                <button type="button" class="btn btn-warning btn-mobile">Seleccionar</button>
                            </div>
                            <input type="file" id="polizaInput" accept="image/*,.pdf" style="display: none;">
                            <div id="polizaPreview" class="document-preview-mobile"></div>
                        </div>
                    </div>
                </div>

                <!-- PASO 3: CALIBRACIÃ“N FUNCIONAL -->
                <div id="step3" class="step-panel">
                    <div class="step-header">
                        <h4>ğŸ¯ Â¿Necesita CalibraciÃ³n?</h4>
                        <p>Determine si el vehÃ­culo requiere calibraciÃ³n</p>
                    </div>

                    <div class="calibracion-form">
                        <div class="calibracion-question">
                            <div class="question-card">
                                <div class="question-icon">ğŸ¯</div>
                                <h5>Â¿Este vehÃ­culo necesita calibraciÃ³n?</h5>
                                <p>La calibraciÃ³n es necesaria despuÃ©s de cambios en el parabrisas o sistemas ADAS</p>
                            </div>

                            <div class="calibracion-options">
                                <button id="calibracionNo" class="btn btn-outline calibracion-btn">
                                    âŒ NO - Continuar proceso
                                </button>
                                <button id="calibracionSi" class="btn btn-warning calibracion-btn">
                                    âœ… SÃ - Requiere calibraciÃ³n
                                </button>
                            </div>
                        </div>

                        <div id="calibracionInfo" class="calibracion-info" style="display: none;">
                            <div class="info-card">
                                <div class="info-icon">ğŸ“‹</div>
                                <h6>Registro de CalibraciÃ³n Creado</h6>
                                <p>Se ha creado un registro pendiente que podrÃ¡ gestionar desde la secciÃ³n Calibraciones</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PASO 4: FIRMA -->
                <div id="step4" class="step-panel">
                    <div class="step-header">
                        <h4>âœï¸ Firma Digital</h4>
                        <p>Firma con el dedo en la pantalla</p>
                    </div>

                    <div class="signature-section-mobile">
                        <div class="signature-container-mobile">
                            <canvas id="signatureCanvas" class="signature-canvas-mobile"></canvas>
                            <div class="signature-placeholder" id="signaturePlaceholder">
                                <div class="placeholder-icon">âœï¸</div>
                                <p>Firme aquÃ­ con el dedo</p>
                            </div>
                        </div>

                        <div class="signature-controls-mobile">
                            <button id="clearSignature" class="btn btn-outline btn-mobile">ğŸ—‘ï¸ Limpiar</button>
                            <button id="saveSignature" class="btn btn-success btn-mobile">âœ… Guardar</button>
                        </div>
                    </div>
                </div>

                <!-- PASO 5: PDF CON VISTA PREVIA -->
                <div id="step5" class="step-panel">
                    <div class="step-header">
                        <h4>ğŸ“‹ Generar Informe</h4>
                        <p>Resumen y descarga del PDF</p>
                    </div>

                    <div id="summary" class="summary-mobile">
                        <div class="summary-card-mobile">
                            <h5>ğŸ“Š Resumen del Expediente</h5>
                            <div id="summaryContent" class="summary-content-mobile"></div>
                        </div>

                        <!-- VISTA PREVIA PDF -->
                        <div class="pdf-preview-mobile">
                            <h6>Vista Previa del PDF</h6>
                            <div class="pdf-header-preview">
                                <div class="logo-container-pdf">
                                    <img src="logolargo.png" alt="GlassDrive" class="logo-pdf">
                                </div>
                                <div id="centerInfoPDF" class="center-info-pdf">
                                    <h4>Centro: MonzÃ³n</h4>
                                    <p id="currentDate">15/10/2025</p>
                                </div>
                            </div>
                            <div class="pdf-content-preview">
                                <p><strong>MatrÃ­cula:</strong> <span id="pdfMatricula">-</span></p>
                                <p><strong>Cliente:</strong> Cliente MVP Demo</p>
                                <p><strong>Fotos:</strong> <span id="pdfFotos">0</span></p>
                                <p><strong>Documentos:</strong> <span id="pdfDocs">0</span></p>
                                <p><strong>CalibraciÃ³n:</strong> <span id="pdfCalibracion">No requerida</span></p>
                                <p><strong>Firma:</strong> <span id="pdfFirma">No</span></p>
                            </div>
                        </div>

                        <div class="pdf-options-mobile">
                            <button id="generatePDFBtn" class="btn btn-success btn-large btn-mobile">
                                ğŸ“¥ Generar y Descargar PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FOOTER MÃS VISIBLE -->
            <div class="modal-footer-enhanced">
                <div class="progress-mobile">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="footer-controls-enhanced">
                    <button id="prevStep" class="btn btn-outline btn-footer" style="display: none;">
                        â† Anterior
                    </button>
                    <button id="nextStep" class="btn btn-primary btn-footer">
                        Siguiente â†’
                    </button>
                    <button id="finishStep" class="btn btn-success btn-footer" style="display: none;">
                        âœ… Finalizar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL CALIBRACIÃ“N CON FOOTER MEJORADO -->
    <div id="calibracionModal" class="modal">
        <div class="modal-content-fixed">
            <div class="modal-header">
                <div class="modal-title">
                    <h3>ğŸ¯ Proceso de CalibraciÃ³n</h3>
                    <p>GestiÃ³n del proceso de calibraciÃ³n</p>
                </div>
                <button id="closeCalibracionModal" class="modal-close">&times;</button>
            </div>

            <div class="modal-body-scrollable">
                <div id="calibracionContent" class="calibracion-process"></div>
            </div>

            <!-- FOOTER CALIBRACIÃ“N MÃS VISIBLE -->
            <div class="modal-footer-enhanced">
                <div class="footer-controls-enhanced">
                    <button id="cancelCalibracion" class="btn btn-outline btn-footer">âŒ Cancelar</button>
                    <button id="saveCalibracion" class="btn btn-success btn-footer">âœ… Guardar CalibraciÃ³n</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
