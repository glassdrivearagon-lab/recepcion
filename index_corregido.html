<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlassDrive - Sistema de Recepci√≥n</title>
    <link rel="stylesheet" href="style.css">

    <!-- DEPENDENCIAS CORREGIDAS -->
    <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- PANTALLA DE LOGIN -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <img src="logolargo.jpg" alt="GlassDrive" class="login-logo">
                <h1>Sistema de Recepci√≥n</h1>
                <p>Seleccione su centro de trabajo</p>
            </div>

            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="selectTaller">Centro GlassDrive:</label>
                    <select id="selectTaller" required>
                        <option value="">-- Seleccionar Centro --</option>
                        <option value="monzon">Monz√≥n</option>
                        <option value="barbastro">Barbastro</option>
                        <option value="lleida">Lleida</option>
                        <option value="fraga">Fraga</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary btn-large">
                    Iniciar Sesi√≥n
                </button>
            </form>
        </div>
    </div>

    <!-- APLICACI√ìN PRINCIPAL -->
    <div id="mainApp" class="screen">
        <!-- HEADER -->
        <header class="app-header">
            <div class="header-left">
                <img src="logolargo.jpg" alt="GlassDrive" class="header-logo">
                <h2>Sistema de Recepci√≥n</h2>
            </div>
            <div class="header-right">
                <span id="userInfo" class="user-info"></span>
                <button id="btnLogout" class="btn btn-secondary">Cerrar Sesi√≥n</button>
            </div>
        </header>

        <!-- NAVEGACI√ìN CORREGIDA -->
        <nav class="app-nav">
            <button id="btnDashboard" class="nav-btn active">Dashboard</button>
            <button id="btnNuevoRegistro" class="nav-btn">Nuevo Registro</button>
            <button id="btnBusqueda" class="nav-btn">B√∫squeda</button>
        </nav>

        <!-- DASHBOARD -->
        <section id="dashboard" class="content-section active">
            <h3>Dashboard</h3>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalVehiculos">0</div>
                    <div class="stat-label">Total Veh√≠culos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="registrosHoy">0</div>
                    <div class="stat-label">Registros Hoy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="enProceso">0</div>
                    <div class="stat-label">En Proceso</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completados">0</div>
                    <div class="stat-label">Completados</div>
                </div>
            </div>

            <div class="recent-section">
                <h4>Registros Recientes</h4>
                <div id="recentList" class="recent-list"></div>
            </div>
        </section>

        <!-- B√öSQUEDA -->
        <section id="busqueda" class="content-section">
            <h3>B√∫squeda de Expedientes</h3>

            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Buscar por matr√≠cula o cliente...">
                <button id="btnSearch" class="btn btn-primary">Buscar</button>
            </div>

            <div id="searchResults" class="search-results"></div>
        </section>
    </div>

    <!-- MODAL DE REGISTRO -->
    <div id="registroModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Registro de Veh√≠culo</h3>
                <button id="closeModal" class="modal-close">&times;</button>
            </div>

            <!-- STEPS -->
            <div class="wizard-steps">
                <div class="step active">
                    <span class="step-number">1</span>
                    <span class="step-label">Fotograf√≠as</span>
                </div>
                <div class="step">
                    <span class="step-number">2</span>
                    <span class="step-label">Documentos</span>
                </div>
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-label">Finalizar</span>
                </div>
            </div>

            <!-- STEP 1: FOTOGRAF√çAS -->
            <div id="step1" class="wizard-step active">
                <h4>Captura de Fotograf√≠as</h4>

                <div class="camera-section">
                    <video id="cameraPreview" style="display: none;" autoplay playsinline></video>
                    <canvas id="photoCanvas" style="display: none;"></canvas>

                    <div class="camera-controls">
                        <button id="capturePhoto" class="btn btn-primary" style="display: none;">
                            üì∑ Capturar Foto
                        </button>
                        <button id="selectPhoto" class="btn btn-secondary">
                            üìÅ Subir Fotos
                        </button>
                        <input type="file" id="uploadPhoto" accept="image/*" multiple style="display: none;">
                    </div>
                </div>

                <div id="photosGrid" class="photos-grid"></div>

                <!-- RESULTADO OCR -->
                <div id="ocrResults" style="display: none; margin-top: 20px;"></div>
            </div>

            <!-- STEP 2: DOCUMENTOS -->
            <div id="step2" class="wizard-step">
                <h4>Subida de Documentos</h4>

                <div class="documents-section">
                    <!-- FICHA T√âCNICA -->
                    <div class="document-upload">
                        <h5>Ficha T√©cnica del Veh√≠culo</h5>
                        <button id="selectDocument" class="btn btn-info">
                            üìÑ Seleccionar Ficha T√©cnica
                        </button>
                        <input type="file" id="uploadDocument" accept="image/*,.pdf" style="display: none;">
                        <div id="documentPreview" style="display: none;"></div>
                        <div id="extractedTechnicalData" style="display: none;">
                            <div id="technicalDataGrid"></div>
                        </div>
                    </div>

                    <!-- P√ìLIZA DE SEGURO -->
                    <div class="document-upload">
                        <h5>P√≥liza de Seguro</h5>
                        <button id="selectPolicy" class="btn btn-warning">
                            üìã Seleccionar P√≥liza
                        </button>
                        <input type="file" id="uploadPolicy" accept="image/*,.pdf" style="display: none;">
                        <div id="policyPreview" style="display: none;"></div>
                        <div id="extractedPolicyData" style="display: none;">
                            <div id="policyDataGrid"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 3: FINALIZAR -->
            <div id="step3" class="wizard-step">
                <h4>Resumen del Registro</h4>
                <div class="summary-section">
                    <p>Revise los datos antes de finalizar el registro:</p>
                    <div id="registroSummary" class="summary-content"></div>
                </div>
            </div>

            <!-- MODAL FOOTER -->
            <div class="modal-footer">
                <button id="prevStep" class="btn btn-secondary" style="display: none;">
                    ‚Üê Anterior
                </button>
                <button id="nextStep" class="btn btn-primary">
                    Siguiente ‚Üí
                </button>
                <button id="finishRegistro" class="btn btn-success" style="display: none;">
                    ‚úÖ Finalizar Registro
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE EXPEDIENTE -->
    <div id="expedienteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="expedienteTitulo">Expediente</h3>
                <button id="closeExpedienteModal" class="modal-close">&times;</button>
            </div>
            <div id="expedienteContent" class="expediente-content"></div>
        </div>
    </div>

    <!-- CARGA DE SCRIPTS CORREGIDA -->
    <script>
        // Verificar dependencias al cargar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç Verificando dependencias...');

            let dependenciasListas = 0;
            const totalDependencias = 2;

            function iniciarApp() {
                dependenciasListas++;
                if (dependenciasListas >= totalDependencias) {
                    console.log('‚úÖ Todas las dependencias cargadas, iniciando app...');
                    // La aplicaci√≥n se iniciar√° desde app.js
                }
            }

            // Verificar Tesseract
            if (typeof Tesseract !== 'undefined') {
                console.log('‚úÖ Tesseract.js cargado');
                iniciarApp();
            } else {
                console.warn('‚ö†Ô∏è Tesseract.js no disponible');
                iniciarApp(); // Continuar sin OCR
            }

            // Verificar jsPDF
            if (typeof jsPDF !== 'undefined' || typeof window.jspdf !== 'undefined') {
                console.log('‚úÖ jsPDF cargado');
                iniciarApp();
            } else {
                console.warn('‚ö†Ô∏è jsPDF no disponible');
                iniciarApp(); // Continuar sin PDF
            }
        });
    </script>

    <script src="app.js"></script>
</body>
</html>